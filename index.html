<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Woofswap - Cross-Chain Bridge</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff9100;
            --secondary-color: #ff6f61;
            --gradient-bg: linear-gradient(180deg, #1e1e2f 0%, #2a2a3d 100%);
            --card-bg: #2c2f48;
            --input-bg: #373b5c;
            --text-color: #ffffff;
            --border-radius: 15px;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--gradient-bg);
            color: var(--text-color);
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 480px;
            background: var(--card-bg);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border-radius: var(--border-radius);
            padding: 20px;
            position: relative;
        }
        .header {
            background: linear-gradient(90deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            padding: 12px;
            border-radius: var(--border-radius);
            text-align: center;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .connect-section button {
            padding: 12px;
            background: var(--primary-color);
            color: var(--text-color);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: background 0.2s;
            margin-bottom: 10px;
        }
        .connect-section button:hover { background: #e68a00; }
        .swap-box {
            background: var(--input-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            position: relative;
        }
        .balance-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            margin-bottom: 5px;
            color: #ff9100;
        }
        .chain-select, .token-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: var(--card-bg);
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .chain-select select {
            background: transparent;
            border: none;
            color: var(--text-color);
            font-size: 1em;
            cursor: pointer;
            outline: none;
        }
        .chain-select select option {
            background: var(--card-bg);
            color: var(--text-color);
        }
        .token-display div {
            display: flex;
            align-items: center;
        }
        .token-display img {
            width: 24px;
            height: 24px;
            margin-right: 10px;
        }
        input {
            width: 100%;
            padding: 10px;
            background: var(--input-bg);
            border: none;
            border-radius: 10px;
            color: var(--text-color);
            font-size: 1em;
            text-align: right;
        }
        .percentage-buttons {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        .percentage-buttons button {
            padding: 5px 10px;
            background: #4a4f7a;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: var(--text-color);
            flex: 1;
        }
        .percentage-buttons button:hover { background: #5a5f8a; }
        .switch-button {
            text-align: center;
            margin: 15px 0;
        }
        .switch-button button {
            padding: 10px;
            background: var(--primary-color);
            color: var(--text-color);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        .swap-button {
            padding: 15px;
            background: var(--primary-color);
            color: var(--text-color);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: background 0.2s;
        }
        .swap-button:disabled {
            background: #4a4f7a;
            cursor: not-allowed;
        }
        .swap-button:hover:not(:disabled), .switch-button button:hover { background: #e68a00; }
        .status {
            margin-top: 10px;
            font-size: 0.9em;
            color: var(--primary-color);
            text-align: center;
        }
        .swap-note {
            font-size: 0.9em;
            color: #ff9100;
            margin-top: 5px;
            text-align: left;
        }
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 5px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .dog-section {
            text-align: center;
            margin-top: 20px;
        }
        .dog-section img {
            width: 60px;
            height: 60px;
            margin-bottom: 10px;
        }
        .dog-message {
            font-size: 0.9em;
            color: var(--secondary-color);
            font-style: italic;
        }
        @media (max-width: 480px) {
            body { padding: 10px; }
            .container { padding: 15px; }
            .header { font-size: 1.1em; }
            .percentage-buttons button { padding: 5px; }
            .dog-section img { width: 50px; height: 50px; }
            .dog-message { font-size: 0.8em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">Woofswap - Cross-Chain Bridge</div>
        <div class="connect-section">
            <button id="connectWalletButton">Connect Wallet</button>
            <div id="networkStatus" class="status">Click to connect...</div>
        </div>
        <div class="swap-box">
            <div class="balance-row">
                <span>From</span>
                <span id="fromBalance">Balance: 0</span>
            </div>
            <div class="chain-select">
                <select id="fromChain" onchange="updateChains()">
                    <option value="Shibarium">Shibarium</option>
                    <option value="Base">Base</option>
                </select>
            </div>
            <div class="token-display">
                <div>
                    <img src="https://www.woofswap.finance/image/tokens/luisa.png" alt="LUISA">
                    <span>LUISA</span>
                </div>
            </div>
            <input type="number" id="fromAmount" placeholder="0.0" step="0.01">
            <div class="percentage-buttons">
                <button onclick="setPercentage(25)">25%</button>
                <button onclick="setPercentage(50)">50%</button>
                <button onclick="setPercentage(75)">75%</button>
                <button onclick="setPercentage(100)">MAX</button>
            </div>
        </div>
        <div class="switch-button">
            <button onclick="switchChains()">↓↑</button>
        </div>
        <div class="swap-box">
            <div class="balance-row">
                <span>To</span>
                <span id="toBalance">Balance: 0</span>
            </div>
            <div class="chain-select">
                <span id="toChain"></span>
            </div>
            <div class="token-display">
                <div>
                    <img src="https://www.woofswap.finance/image/tokens/luisa.png" alt="LUISA">
                    <span>LUISA</span>
                </div>
            </div>
            <input type="text" id="receiverAddress" placeholder="Receiver Address (defaults to your address)">
            <div class="swap-note" id="swapNote">Cross-chain transfer powered by Chainlink CCIP</div>
        </div>
        <button class="swap-button" id="swapButton" onclick="initiateCrossChainTransfer()">Initiate Transfer</button>
        <div class="dog-section">
            <img src="images/shiba.gif" alt="Shiba Dog">
            <div class="dog-message" id="dogMessage">"Woof! Connect your wallet to start bridging, pup!"</div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <script>
        const chains = {
            Shibarium: {
                chainId: 109,
                chainName: 'Shibarium',
                rpcUrl: 'https://rpc.shibariumchain.com',
                poolAddress: '0xCa8FaCd0EB11DEB6114d515D136c79C6f4170E87',
                tokenAddress: '0x0cCD687CC6F8461170336D8e8cf46A39313DEab9',
                chainSelector: '4051577827741608506',
                mechanism: 'Lock & Release',
                routerAddress: '0xc2CA5d5C17911e4B838194b51585DdF8fe5116C1'
            },
            Base: {
                chainId: 8453,
                chainName: 'Base',
                rpcUrl: 'https://mainnet.base.org',
                poolAddress: '0xe9516fb95778682f48c551071bb917f937229596',
                tokenAddress: '0x5699c51660C765e57793D1837B400B241cbC4B46',
                chainSelector: '15971525489660198786',
                mechanism: 'Burn & Mint',
                routerAddress: '0x881e3A65B4d4a04dD529061dd0071cf975F58bCD'
            }
        };

        const poolAbi = [{"inputs":[{"internalType":"contract IERC20","name":"token","type":"address"},{"internalType":"uint8","name":"localTokenDecimals","type":"uint8"},{"internalType":"address[]","name":"allowlist","type":"address[]"},{"internalType":"address","name":"rmnProxy","type":"address"},{"internalType":"bool","name":"acceptLiquidity","type":"bool"},{"internalType":"address","name":"router","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"uint256","name":"capacity","type":"uint256"},{"internalType":"uint256","name":"requested","type":"uint256"}],"name":"AggregateValueMaxCapacityExceeded","type":"error"},{"inputs":[{"internalType":"uint256","name":"minWaitInSeconds","type":"uint256"},{"internalType":"uint256","name":"available","type":"uint256"}],"name":"AggregateValueRateLimitReached","type":"error"},{"inputs":[],"name":"AllowListNotEnabled","type":"error"},{"inputs":[],"name":"BucketOverfilled","type":"error"},{"inputs":[{"internalType":"address","name":"caller","type":"address"}],"name":"CallerIsNotARampOnRouter","type":"error"},{"inputs":[],"name":"CannotTransferToSelf","type":"error"},{"inputs":[{"internalType":"uint64","name":"chainSelector","type":"uint64"}],"name":"ChainAlreadyExists","type":"error"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"}],"name":"ChainNotAllowed","type":"error"},{"inputs":[],"name":"CursedByRMN","type":"error"},{"inputs":[{"components":[{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"internalType":"struct RateLimiter.Config","name":"config","type":"tuple"}],"name":"DisabledNonZeroRateLimit","type":"error"},{"inputs":[],"name":"InsufficientLiquidity","type":"error"},{"inputs":[{"internalType":"uint8","name":"expected","type":"uint8"},{"internalType":"uint8","name":"actual","type":"uint8"}],"name":"InvalidDecimalArgs","type":"error"},{"inputs":[{"components":[{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"internalType":"struct RateLimiter.Config","name":"rateLimiterConfig","type":"tuple"}],"name":"InvalidRateLimitRate","type":"error"},{"inputs":[{"internalType":"bytes","name":"sourcePoolData","type":"bytes"}],"name":"InvalidRemoteChainDecimals","type":"error"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"internalType":"bytes","name":"remotePoolAddress","type":"bytes"}],"name":"InvalidRemotePoolForChain","type":"error"},{"inputs":[{"internalType":"bytes","name":"sourcePoolAddress","type":"bytes"}],"name":"InvalidSourcePoolAddress","type":"error"},{"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"InvalidToken","type":"error"},{"inputs":[],"name":"LiquidityNotAccepted","type":"error"},{"inputs":[],"name":"MustBeProposedOwner","type":"error"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"}],"name":"NonExistentChain","type":"error"},{"inputs":[],"name":"OnlyCallableByOwner","type":"error"},{"inputs":[{"internalType":"uint8","name":"remoteDecimals","type":"uint8"},{"internalType":"uint8","name":"localDecimals","type":"uint8"},{"internalType":"uint256","name":"remoteAmount","type":"uint256"}],"name":"OverflowDetected","type":"error"},{"inputs":[],"name":"OwnerCannotBeZero","type":"error"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"internalType":"bytes","name":"remotePoolAddress","type":"bytes"}],"name":"PoolAlreadyAdded","type":"error"},{"inputs":[],"name":"RateLimitMustBeDisabled","type":"error"},{"inputs":[{"internalType":"address","name":"sender","type":"address"}],"name":"SenderNotAllowed","type":"error"},{"inputs":[{"internalType":"uint256","name":"capacity","type":"uint256"},{"internalType":"uint256","name":"requested","type":"uint256"},{"internalType":"address","name":"tokenAddress","type":"address"}],"name":"TokenMaxCapacityExceeded","type":"error"},{"inputs":[{"internalType":"uint256","name":"minWaitInSeconds","type":"uint256"},{"internalType":"uint256","name":"available","type":"uint256"},{"internalType":"address","name":"tokenAddress","type":"address"}],"name":"TokenRateLimitReached","type":"error"},{"inputs":[{"internalType":"address","name":"caller","type":"address"}],"name":"Unauthorized","type":"error"},{"inputs":[],"name":"ZeroAddressNotAllowed","type":"error"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"sender","type":"address"}],"name":"AllowListAdd","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"sender","type":"address"}],"name":"AllowListRemove","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Burned","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"indexed":false,"internalType":"bytes","name":"remoteToken","type":"bytes"},{"components":[{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"indexed":false,"internalType":"struct RateLimiter.Config","name":"outboundRateLimiterConfig","type":"tuple"},{"components":[{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"indexed":false,"internalType":"struct RateLimiter.Config","name":"inboundRateLimiterConfig","type":"tuple"}],"name":"ChainAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"components":[{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"indexed":false,"internalType":"struct RateLimiter.Config","name":"outboundRateLimiterConfig","type":"tuple"},{"components":[{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"indexed":false,"internalType":"struct RateLimiter.Config","name":"inboundRateLimiterConfig","type":"tuple"}],"name":"ChainConfigured","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint64","name":"remoteChainSelector","type":"uint64"}],"name":"ChainRemoved","type":"event"},{"anonymous":false,"inputs":[{"components":[{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"indexed":false,"internalType":"struct RateLimiter.Config","name":"config","type":"tuple"}],"name":"ConfigChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"provider","type":"address"},{"indexed":true,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"LiquidityAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"provider","type":"address"},{"indexed":true,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"LiquidityRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"LiquidityTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Locked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":true,"internalType":"address","name":"recipient","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Minted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"OwnershipTransferRequested","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"rateLimitAdmin","type":"address"}],"name":"RateLimitAdminSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":true,"internalType":"address","name":"recipient","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Released","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"indexed":false,"internalType":"bytes","name":"remotePoolAddress","type":"bytes"}],"name":"RemotePoolAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"indexed":false,"internalType":"bytes","name":"remotePoolAddress","type":"bytes"}],"name":"RemotePoolRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"oldRouter","type":"address"},{"indexed":false,"internalType":"address","name":"newRouter","type":"address"}],"name":"RouterUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"tokens","type":"uint256"}],"name":"TokensConsumed","type":"event"},{"inputs":[],"name":"acceptOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"internalType":"bytes","name":"remotePoolAddress","type":"bytes"}],"name":"addRemotePool","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address[]","name":"removes","type":"address[]"},{"internalType":"address[]","name":"adds","type":"address[]"}],"name":"applyAllowListUpdates","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint64[]","name":"remoteChainSelectorsToRemove","type":"uint64[]"},{"components":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"internalType":"bytes[]","name":"remotePoolAddresses","type":"bytes[]"},{"internalType":"bytes","name":"remoteTokenAddress","type":"bytes"},{"components":[{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"internalType":"struct RateLimiter.Config","name":"outboundRateLimiterConfig","type":"tuple"},{"components":[{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"internalType":"struct RateLimiter.Config","name":"inboundRateLimiterConfig","type":"tuple"}],"internalType":"struct TokenPool.ChainUpdate[]","name":"chainsToAdd","type":"tuple[]"}],"name":"applyChainUpdates","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"canAcceptLiquidity","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getAllowList","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getAllowListEnabled","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"}],"name":"getCurrentInboundRateLimiterState","outputs":[{"components":[{"internalType":"uint128","name":"tokens","type":"uint128"},{"internalType":"uint32","name":"lastUpdated","type":"uint32"},{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"internalType":"struct RateLimiter.TokenBucket","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"}],"name":"getCurrentOutboundRateLimiterState","outputs":[{"components":[{"internalType":"uint128","name":"tokens","type":"uint128"},{"internalType":"uint32","name":"lastUpdated","type":"uint32"},{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"internalType":"struct RateLimiter.TokenBucket","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getRateLimitAdmin","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getRebalancer","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"}],"name":"getRemotePools","outputs":[{"internalType":"bytes[]","name":"","type":"bytes[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"}],"name":"getRemoteToken","outputs":[{"internalType":"bytes","name":"","type":"bytes"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getRmnProxy","outputs":[{"internalType":"address","name":"rmnProxy","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getRouter","outputs":[{"internalType":"address","name":"router","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getSupportedChains","outputs":[{"internalType":"uint64[]","name":"","type":"uint64[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getToken","outputs":[{"internalType":"contract IERC20","name":"token","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTokenDecimals","outputs":[{"internalType":"uint8","name":"decimals","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"internalType":"bytes","name":"remotePoolAddress","type":"bytes"}],"name":"isRemotePool","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"}],"name":"isSupportedChain","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"isSupportedToken","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"bytes","name":"receiver","type":"bytes"},{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"internalType":"address","name":"originalSender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"address","name":"localToken","type":"address"}],"internalType":"struct Pool.LockOrBurnInV1","name":"lockOrBurnIn","type":"tuple"}],"name":"lockOrBurn","outputs":[{"components":[{"internalType":"bytes","name":"destTokenAddress","type":"bytes"},{"internalType":"bytes","name":"destPoolData","type":"bytes"}],"internalType":"struct Pool.LockOrBurnOutV1","name":"","type":"tuple"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"provideLiquidity","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"bytes","name":"originalSender","type":"bytes"},{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"address","name":"localToken","type":"address"},{"internalType":"bytes","name":"sourcePoolAddress","type":"bytes"},{"internalType":"bytes","name":"sourcePoolData","type":"bytes"},{"internalType":"bytes","name":"offchainTokenData","type":"bytes"}],"internalType":"struct Pool.ReleaseOrMintInV1","name":"releaseOrMintIn","type":"tuple"}],"name":"releaseOrMint","outputs":[{"components":[{"internalType":"uint256","name":"destinationAmount","type":"uint256"}],"internalType":"struct Pool.ReleaseOrMintOutV1","name":"","type":"tuple"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"internalType":"bytes","name":"remotePoolAddress","type":"bytes"}],"name":"removeRemotePool","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint64","name":"remoteChainSelector","type":"uint64"},{"components":[{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"internalType":"struct RateLimiter.Config","name":"outboundConfig","type":"tuple"},{"components":[{"internalType":"bool","name":"isEnabled","type":"bool"},{"internalType":"uint128","name":"capacity","type":"uint128"},{"internalType":"uint128","name":"rate","type":"uint128"}],"internalType":"struct RateLimiter.Config","name":"inboundConfig","type":"tuple"}],"name":"setChainRateLimiterConfig","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"rateLimitAdmin","type":"address"}],"name":"setRateLimitAdmin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"rebalancer","type":"address"}],"name":"setRebalancer","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newRouter","type":"address"}],"name":"setRouter","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"pure","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferLiquidity","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"typeAndVersion","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdrawLiquidity","outputs":[],"stateMutability":"nonpayable","type":"function"}];

        const routerAbi = [{"inputs":[{"internalType":"address","name":"wrappedNative","type":"address"},{"internalType":"address","name":"armProxy","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"BadARMSignal","type":"error"},{"inputs":[],"name":"FailedToSendValue","type":"error"},{"inputs":[],"name":"InsufficientFeeTokenAmount","type":"error"},{"inputs":[],"name":"InvalidMsgValue","type":"error"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"InvalidRecipientAddress","type":"error"},{"inputs":[{"internalType":"uint64","name":"chainSelector","type":"uint64"},{"internalType":"address","name":"offRamp","type":"address"}],"name":"OffRampMismatch","type":"error"},{"inputs":[],"name":"OnlyOffRamp","type":"error"},{"inputs":[{"internalType":"uint64","name":"destChainSelector","type":"uint64"}],"name":"UnsupportedDestinationChain","type":"error"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"messageId","type":"bytes32"},{"indexed":false,"internalType":"uint64","name":"sourceChainSelector","type":"uint64"},{"indexed":false,"internalType":"address","name":"offRamp","type":"address"},{"indexed":false,"internalType":"bytes32","name":"calldataHash","type":"bytes32"}],"name":"MessageExecuted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint64","name":"sourceChainSelector","type":"uint64"},{"indexed":false,"internalType":"address","name":"offRamp","type":"address"}],"name":"OffRampAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint64","name":"sourceChainSelector","type":"uint64"},{"indexed":false,"internalType":"address","name":"offRamp","type":"address"}],"name":"OffRampRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint64","name":"destChainSelector","type":"uint64"},{"indexed":false,"internalType":"address","name":"onRamp","type":"address"}],"name":"OnRampSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"OwnershipTransferRequested","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[],"name":"MAX_RET_BYTES","outputs":[{"internalType":"uint16","name":"","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"acceptOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"uint64","name":"destChainSelector","type":"uint64"},{"internalType":"address","name":"onRamp","type":"address"}],"internalType":"struct Router.OnRamp[]","name":"onRampUpdates","type":"tuple[]"},{"components":[{"internalType":"uint64","name":"sourceChainSelector","type":"uint64"},{"internalType":"address","name":"offRamp","type":"address"}],"internalType":"struct Router.OffRamp[]","name":"offRampRemoves","type":"tuple[]"},{"components":[{"internalType":"uint64","name":"sourceChainSelector","type":"uint64"},{"internalType":"address","name":"offRamp","type":"address"}],"internalType":"struct Router.OffRamp[]","name":"offRampAdds","type":"tuple[]"}],"name":"applyRampUpdates","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint64","name":"destinationChainSelector","type":"uint64"},{"components":[{"internalType":"bytes","name":"receiver","type":"bytes"},{"internalType":"bytes","name":"data","type":"bytes"},{"components":[{"internalType":"address","name":"token","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"internalType":"struct Client.EVMTokenAmount[]","name":"tokenAmounts","type":"tuple[]"},{"internalType":"address","name":"feeToken","type":"address"},{"internalType":"bytes","name":"extraArgs","type":"bytes"}],"internalType":"struct Client.EVM2AnyMessage","name":"message","type":"tuple"}],"name":"ccipSend","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"getArmProxy","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"destinationChainSelector","type":"uint64"},{"components":[{"internalType":"bytes","name":"receiver","type":"bytes"},{"internalType":"bytes","name":"data","type":"bytes"},{"components":[{"internalType":"address","name":"token","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"internalType":"struct Client.EVMTokenAmount[]","name":"tokenAmounts","type":"tuple[]"},{"internalType":"address","name":"feeToken","type":"address"},{"internalType":"bytes","name":"extraArgs","type":"bytes"}],"internalType":"struct Client.EVM2AnyMessage","name":"message","type":"tuple"}],"name":"getFee","outputs":[{"internalType":"uint256","name":"fee","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getOffRamps","outputs":[{"components":[{"internalType":"uint64","name":"sourceChainSelector","type":"uint64"},{"internalType":"address","name":"offRamp","type":"address"}],"internalType":"struct Router.OffRamp[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"destChainSelector","type":"uint64"}],"name":"getOnRamp","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"chainSelector","type":"uint64"}],"name":"getSupportedTokens","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getWrappedNative","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"chainSelector","type":"uint64"}],"name":"isChainSupported","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"sourceChainSelector","type":"uint64"},{"internalType":"address","name":"offRamp","type":"address"}],"name":"isOffRamp","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"tokenAddress","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"recoverTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"bytes32","name":"messageId","type":"bytes32"},{"internalType":"uint64","name":"sourceChainSelector","type":"uint64"},{"internalType":"bytes","name":"sender","type":"bytes"},{"internalType":"bytes","name":"data","type":"bytes"},{"components":[{"internalType":"address","name":"token","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"internalType":"struct Client.EVMTokenAmount[]","name":"destTokenAmounts","type":"tuple[]"}],"internalType":"struct Client.Any2EVMMessage","name":"message","type":"tuple"},{"internalType":"uint16","name":"gasForCallExactCheck","type":"uint16"},{"internalType":"uint256","name":"gasLimit","type":"uint256"},{"internalType":"address","name":"receiver","type":"address"}],"name":"routeMessage","outputs":[{"internalType":"bool","name":"success","type":"bool"},{"internalType":"bytes","name":"retData","type":"bytes"},{"internalType":"uint256","name":"gasUsed","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"wrappedNative","type":"address"}],"name":"setWrappedNative","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"typeAndVersion","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}];

        const erc20Abi = [
            {"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},
            {"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"type":"function"},
            {"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"type":"function"}
        ];

        let web3, account, currentPoolContract, currentTokenContract, currentRouterContract, fromChain = 'Shibarium', toChain = 'Base', fromBalance = '0', toBalance = '0';

        const dogMessages = {
            connectSuccess: ["Woof! Wallet connected, ready to bridge, pup!", "Arf! You're in, let's get bridging!", "Bark! Wallet's ready, time to cross chains!"],
            connectFail: ["Woof! Couldn't connect wallet, try again, pup!", "Arf! Wallet connection failed, give it another go!", "Bark! Something went wrong, check your wallet!"],
            transferStart: ["Woof! Bridging your LUISA, hold tight, pup!", "Arf! Sending your tokens across the chain!", "Bark! Cross-chain transfer in progress!"],
            transferSuccess: ["Woof! Transfer initiated, your LUISA is on its way!", "Arf! Bridge complete, check the destination chain!", "Bark! Success! Your tokens are crossing chains!"],
            transferFail: ["Woof! Transfer failed, check the details, pup!", "Arf! Something went wrong, try again!", "Bark! Bridge hit a snag, review and retry!"],
            transferNoAmount: ["Woof! Enter an amount to bridge, pup!", "Arf! Can't bridge nothing, pick an amount!", "Bark! Need an amount to cross the chain!"],
            userDenied: ["Woof! You canceled the transaction, pup!", "Arf! Transaction denied, try again when ready!", "Bark! You said no, let's try that again!"]
        };

        function getRandomMessage(type) {
            const messages = dogMessages[type];
            return messages[Math.floor(Math.random() * messages.length)];
        }

        async function initializeWeb3() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const accounts = await web3.eth.getAccounts();
                    account = accounts[0];
                    document.getElementById('connectWalletButton').innerText = `Connected: ${account.slice(0, 6)}...${account.slice(-4)}`;
                    await switchNetwork(fromChain);
                    await initializeContracts();
                    await updateBalances();
                    document.getElementById('networkStatus').innerText = `Connected to ${fromChain}`;
                    document.getElementById('dogMessage').innerText = getRandomMessage('connectSuccess');
                } catch (error) {
                    document.getElementById('networkStatus').innerText = 'Failed to connect wallet';
                    document.getElementById('dogMessage').innerText = getRandomMessage('connectFail');
                    console.error("Wallet connection error:", error);
                }
            } else {
                document.getElementById('networkStatus').innerText = 'Please install MetaMask';
                document.getElementById('dogMessage').innerText = 'Woof! MetaMask not found, pup!';
            }
        }

        async function switchNetwork(chain) {
            const chainConfig = chains[chain];
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: `0x${chainConfig.chainId.toString(16)}` }]
                });
            } catch (switchError) {
                if (switchError.code === 4902) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: `0x${chainConfig.chainId.toString(16)}`,
                            chainName: chainConfig.chainName,
                            rpcUrls: [chainConfig.rpcUrl],
                            nativeCurrency: { name: chainConfig.chainName, symbol: chain === 'Shibarium' ? 'BONE' : 'ETH', decimals: 18 },
                            blockExplorerUrls: [chain === 'Shibarium' ? 'https://shibariumscan.io' : 'https://basescan.org']
                        }]
                    });
                } else {
                    throw switchError;
                }
            }
            await initializeContracts();
        }

        async function initializeContracts() {
            const chainConfig = chains[fromChain];
            currentPoolContract = new web3.eth.Contract(poolAbi, chainConfig.poolAddress);
            currentTokenContract = new web3.eth.Contract(erc20Abi, chainConfig.tokenAddress);
            currentRouterContract = new web3.eth.Contract(routerAbi, chainConfig.routerAddress);
        }

        function updateChains() {
            fromChain = document.getElementById('fromChain').value;
            toChain = fromChain === 'Shibarium' ? 'Base' : 'Shibarium';
            document.getElementById('toChain').innerText = toChain;
            if (web3 && account) {
                switchNetwork(fromChain).then(updateBalances);
            }
        }

        function switchChains() {
            const temp = fromChain;
            fromChain = toChain;
            toChain = temp;
            document.getElementById('fromChain').value = fromChain;
            document.getElementById('toChain').innerText = toChain;
            if (web3 && account) {
                switchNetwork(fromChain).then(updateBalances);
            }
        }

        async function updateBalances() {
            if (!web3 || !account) return;
            try {
                const fromChainConfig = chains[fromChain];
                const toChainConfig = chains[toChain];
                const fromTokenContract = new web3.eth.Contract(erc20Abi, fromChainConfig.tokenAddress);
                const fromBalanceRaw = await fromTokenContract.methods.balanceOf(account).call();
                fromBalance = web3.utils.fromWei(fromBalanceRaw, 'ether');
                document.getElementById('fromBalance').innerText = `Balance: ${parseFloat(fromBalance).toFixed(4)}`;
                const toProvider = new Web3.providers.HttpProvider(toChainConfig.rpcUrl);
                const toWeb3 = new Web3(toProvider);
                const toTokenContract = new toWeb3.eth.Contract(erc20Abi, toChainConfig.tokenAddress);
                const toBalanceRaw = await toTokenContract.methods.balanceOf(account).call();
                toBalance = toWeb3.utils.fromWei(toBalanceRaw, 'ether');
                document.getElementById('toBalance').innerText = `Balance: ${parseFloat(toBalance).toFixed(4)}`;
            } catch (error) {
                document.getElementById('fromBalance').innerText = 'Balance: Error';
                document.getElementById('toBalance').innerText = 'Balance: Error';
                console.error("Balance update error:", error);
            }
        }

        async function setPercentage(percentage) {
            if (!fromBalance) return;
            const amount = (parseFloat(fromBalance) * percentage) / 100;
            document.getElementById('fromAmount').value = amount.toFixed(4);
        }

        async function approveToken(tokenAddress, amount) {
            const tokenContract = new web3.eth.Contract(erc20Abi, tokenAddress);
            const allowance = await tokenContract.methods.allowance(account, chains[fromChain].routerAddress).call();
            console.log(`Allowance: ${allowance}, Required: ${amount}`);
            if (web3.utils.toBN(allowance).lt(web3.utils.toBN(amount))) {
                console.log("Approving token...");
                const approveTx = await tokenContract.methods.approve(chains[fromChain].routerAddress, amount).send({ from: account });
                console.log("Approval transaction:", approveTx.transactionHash);
                const newAllowance = await tokenContract.methods.allowance(account, chains[fromChain].routerAddress).call();
                console.log(`New allowance: ${newAllowance}`);
                if (web3.utils.toBN(newAllowance).lt(web3.utils.toBN(amount))) {
                    throw new Error("Token approval failed: insufficient allowance");
                }
            }
        }

        async function decodeRevertReason(error) {
            if (error.data) {
                const errorData = error.data;
                if (typeof errorData === 'string' && errorData.startsWith('0x')) {
                    const reason = web3.eth.abi.decodeParameter('string', errorData.slice(10));
                    return reason;
                } else if (errorData.message) {
                    return errorData.message;
                }
            }
            return "Unknown revert reason";
        }

        async function initiateCrossChainTransfer() {
            const status = document.getElementById('networkStatus');
            const swapButton = document.getElementById('swapButton');
            const dogMessage = document.getElementById('dogMessage');

            if (!web3 || !account) {
                status.innerText = "Please connect wallet first.";
                dogMessage.innerText = getRandomMessage('connectFail');
                swapButton.disabled = false;
                return;
            }

            const amount = parseFloat(document.getElementById('fromAmount').value);
            if (!amount || amount <= 0 || isNaN(amount)) {
                status.innerText = "Please enter a valid amount.";
                dogMessage.innerText = getRandomMessage('transferNoAmount');
                swapButton.disabled = false;
                return;
            }

            let receiver = document.getElementById('receiverAddress').value.trim();
            if (!receiver) receiver = account;
            if (!web3.utils.isAddress(receiver) || receiver.length !== 42) {
                status.innerText = "Invalid receiver address (must be 42 characters starting with 0x).";
                dogMessage.innerText = "Woof! That address doesn't smell right, pup!";
                swapButton.disabled = false;
                return;
            }

            const amountWei = web3.utils.toWei(amount.toString(), 'ether');
            const balanceRaw = await currentTokenContract.methods.balanceOf(account).call();
            const balanceWei = web3.utils.toBN(balanceRaw);
            console.log(`Token balance: ${balanceWei}, Amount: ${amountWei}`);
            if (balanceWei.lt(web3.utils.toBN(amountWei))) {
                status.innerText = "Insufficient token balance.";
                dogMessage.innerText = "Woof! Not enough LUISA to bridge, pup!";
                swapButton.disabled = false;
                return;
            }

            try {
                swapButton.disabled = true;
                status.innerText = "Checking chain support...";
                dogMessage.innerText = getRandomMessage('transferStart');

                const destinationChainSelector = chains[toChain].chainSelector;
                const isChainSupportedRouter = await currentRouterContract.methods.isChainSupported(destinationChainSelector).call();
                console.log(`Router supports destination chain: ${isChainSupportedRouter}`);
                if (!isChainSupportedRouter) {
                    status.innerText = `Target chain ${toChain} not supported by Router.`;
                    dogMessage.innerText = `Woof! Can't bridge to ${toChain}, pup!`;
                    swapButton.disabled = false;
                    return;
                }

                const isChainSupportedPool = await currentPoolContract.methods.isSupportedChain(destinationChainSelector).call();
                console.log(`Pool supports destination chain: ${isChainSupportedPool}`);
                if (!isChainSupportedPool) {
                    status.innerText = `Target chain ${toChain} not supported by Pool.`;
                    dogMessage.innerText = `Woof! Can't bridge to ${toChain}, pup!`;
                    swapButton.disabled = false;
                    return;
                }

                const supportedTokens = await currentRouterContract.methods.getSupportedTokens(destinationChainSelector).call();
                console.log(`Supported tokens on destination chain: ${supportedTokens}`);
                if (!supportedTokens.includes(chains[fromChain].tokenAddress)) {
                    status.innerText = `Token ${chains[fromChain].tokenAddress} not supported on target chain.`;
                    dogMessage.innerText = "Woof! This token can't be bridged, pup!";
                    swapButton.disabled = false;
                    return;
                }

                const isTokenSupportedPool = await currentPoolContract.methods.isSupportedToken(chains[fromChain].tokenAddress).call();
                console.log(`Pool supports token: ${isTokenSupportedPool}`);
                if (!isTokenSupportedPool) {
                    status.innerText = `Token ${chains[fromChain].tokenAddress} not supported by Pool.`;
                    dogMessage.innerText = "Woof! This token can't be bridged, pup!";
                    swapButton.disabled = false;
                    return;
                }

                const rateLimitState = await currentPoolContract.methods.getCurrentOutboundRateLimiterState(destinationChainSelector).call();
                console.log("Rate limit state:", rateLimitState);
                if (rateLimitState.isEnabled && web3.utils.toBN(rateLimitState.tokens).lt(web3.utils.toBN(amountWei))) {
                    status.innerText = "Rate limit reached, please wait.";
                    dogMessage.innerText = "Woof! Too many transfers, wait a bit, pup!";
                    swapButton.disabled = false;
                    return;
                }

                const strippedReceiver = web3.utils.stripHexPrefix(receiver);
                const receiverBytes = '0x' + web3.utils.padLeft(strippedReceiver, 64);
                console.log(`Receiver bytes: ${receiverBytes}, Length: ${receiverBytes.length}`);
                if (receiverBytes.length !== 66) {
                    throw new Error(`Receiver bytes length incorrect: ${receiverBytes.length}`);
                }

                const message = {
                    receiver: receiverBytes,
                    data: "0x",
                    tokenAmounts: [
                        {
                            token: chains[fromChain].tokenAddress,
                            amount: amountWei
                        }
                    ],
                    feeToken: "0x0000000000000000000000000000000000000000",
                    extraArgs: "0x"
                };
                console.log("Message:", JSON.stringify(message));

                const fee = await currentRouterContract.methods.getFee(destinationChainSelector, message).call();
                const feeInEther = web3.utils.fromWei(fee, 'ether');
                console.log(`Estimated fee: ${feeInEther} ${fromChain === 'Shibarium' ? 'BONE' : 'ETH'}`);
                status.innerText = `Estimated fee: ${feeInEther} ${fromChain === 'Shibarium' ? 'BONE' : 'ETH'}`;

                const nativeBalance = await web3.eth.getBalance(account);
                const nativeBalanceInEther = web3.utils.fromWei(nativeBalance, 'ether');
                console.log(`Native balance: ${nativeBalanceInEther} ${fromChain === 'Shibarium' ? 'BONE' : 'ETH'}`);
                if (web3.utils.toBN(nativeBalance).lt(web3.utils.toBN(fee))) {
                    status.innerText = `Insufficient ${fromChain === 'Shibarium' ? 'BONE' : 'ETH'} for fees.`;
                    dogMessage.innerText = `Woof! Need more ${fromChain === 'Shibarium' ? 'BONE' : 'ETH'} for fees, pup!`;
                    swapButton.disabled = false;
                    return;
                }

                await approveToken(chains[fromChain].tokenAddress, amountWei);

                const feeWithBuffer = web3.utils.toBN(fee).mul(web3.utils.toBN(130)).div(web3.utils.toBN(100));
                console.log(`Fee with buffer: ${web3.utils.fromWei(feeWithBuffer, 'ether')} ${fromChain === 'Shibarium' ? 'BONE' : 'ETH'}`);

                const estimatedGas = await currentRouterContract.methods.ccipSend(destinationChainSelector, message).estimateGas({
                    from: account,
                    value: feeWithBuffer
                });
                console.log(`Estimated gas: ${estimatedGas}`);
                const gasLimit = Math.floor(estimatedGas * 1.2);
                console.log(`Gas limit with buffer: ${gasLimit}`);

                const tx = await currentRouterContract.methods.ccipSend(destinationChainSelector, message).send({
                    from: account,
                    value: feeWithBuffer,
                    gas: web3.utils.toHex(gasLimit)
                });

                const messageId = tx.events.MessageExecuted ? tx.events.MessageExecuted.returnValues.messageId : 'Unknown';
                status.innerText = `Transfer initiated! Message ID: ${messageId.slice(0, 10)}...`;
                dogMessage.innerText = getRandomMessage('transferSuccess');
                await updateBalances();
                swapButton.disabled = false;
            } catch (error) {
                let errorMessage = error.message || "Unknown error";
                const revertReason = await decodeRevertReason(error);
                console.log(`Revert reason: ${revertReason}`);

                if (error.message.includes("TokenRateLimitReached") || error.message.includes("AggregateValueRateLimitReached")) {
                    errorMessage = "Rate limit reached, please wait.";
                    dogMessage.innerText = "Woof! Too many transfers, wait a bit, pup!";
                } else if (error.message.includes("UnsupportedDestinationChain")) {
                    errorMessage = "Target chain not supported.";
                    dogMessage.innerText = `Woof! Can't bridge to ${toChain}, pup!`;
                } else if (error.message.includes("InsufficientFeeTokenAmount")) {
                    errorMessage = `Insufficient ${fromChain === 'Shibarium' ? 'BONE' : 'ETH'} for fees.`;
                    dogMessage.innerText = `Woof! Need more ${fromChain === 'Shibarium' ? 'BONE' : 'ETH'} for fees, pup!`;
                } else if (error.message.includes("InvalidRecipientAddress") || error.message.includes("invalid arrayify value")) {
                    errorMessage = "Invalid receiver address format.";
                    dogMessage.innerText = "Woof! That address doesn't smell right, pup!";
                } else if (error.message.includes("User denied transaction signature")) {
                    errorMessage = "User denied transaction signature.";
                    dogMessage.innerText = getRandomMessage('userDenied');
                } else if (error.message.includes("revert")) {
                    errorMessage = `Transaction reverted: ${revertReason}`;
                    dogMessage.innerText = "Woof! Something broke in the bridge, pup!";
                } else if (error.message.includes("Token approval failed")) {
                    errorMessage = "Token approval failed.";
                    dogMessage.innerText = "Woof! Token approval didn't go through, pup!";
                } else {
                    errorMessage = `Transaction failed: ${error.message} (Revert reason: ${revertReason})`;
                    dogMessage.innerText = getRandomMessage('transferFail');
                }
                console.error("Transaction error:", error.message, error.data);
                status.innerText = errorMessage;
                swapButton.disabled = false;
            }
        }

        document.getElementById('connectWalletButton').addEventListener('click', initializeWeb3);
        document.getElementById('fromChain').addEventListener('change', updateChains);

        updateChains();
    </script>
</body>
</html>
